generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id               Int      @id @default(autoincrement())
  email            String   @unique
  passwordHash     String
  name             String?
  age              Int?
  gender           String?   
  weight           Float?    
  height           Float?    
  activityLevel    Float    @default(1.2) 
  dailyCalorieGoal Int?   
  dailyWaterGoal   Int      @default(2000) // ml
  streak           Int      @default(0)
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  
  // Relations
  mealLogs      MealLog[]
  waterLogs     WaterLog[]
  exercises     Exercise[]
  weightLogs    WeightLog[]
  favoriteMeals FavoriteMeal[]
  achievements  Achievement[]
  dietPlans     DietPlan[]

  // Social Relations
  followedBy    Friendship[] @relation("following")
  following     Friendship[] @relation("follower")
  
  // Password Reset
  passwordResets PasswordResetToken[]
}

model Friendship {
  followerId  Int
  follower    User @relation("follower", fields: [followerId], references: [id])
  followingId Int
  following   User @relation("following", fields: [followingId], references: [id])
  createdAt   DateTime @default(now())

  @@id([followerId, followingId])
}

model MealLog {
  id        Int      @id @default(autoincrement())
  userId    Int
  user      User     @relation(fields: [userId], references: [id])
  foodName  String
  imageUrl  String?  
  calories  Int
  protein   Float?
  carbs     Float?
  fat       Float?
  createdAt DateTime @default(now())
}

model WaterLog {
  id        Int      @id @default(autoincrement())
  userId    Int
  user      User     @relation(fields: [userId], references: [id])
  amount    Int      // ml cinsinden
  createdAt DateTime @default(now())
}

model Exercise {
  id             Int      @id @default(autoincrement())
  userId         Int
  user           User     @relation(fields: [userId], references: [id])
  name           String
  duration       Int      // dakika
  caloriesBurned Int
  createdAt      DateTime @default(now())
}

model WeightLog {
  id        Int      @id @default(autoincrement())
  userId    Int
  user      User     @relation(fields: [userId], references: [id])
  weight    Float
  createdAt DateTime @default(now())
}

model FavoriteMeal {
  id       Int    @id @default(autoincrement())
  userId   Int
  user     User   @relation(fields: [userId], references: [id])
  foodName String
  calories Int
  protein  Float
  carbs    Float
  fat      Float
}

model Achievement {
  id         Int      @id @default(autoincrement())
  userId     Int
  user       User     @relation(fields: [userId], references: [id])
  type       String   // "streak_7", "first_meal", "water_goal"
  unlockedAt DateTime @default(now())
}

// Kullanıcının aktif diyet planı
model DietPlan {
  id              Int      @id @default(autoincrement())
  userId          Int
  user            User     @relation(fields: [userId], references: [id])
  
  // Kullanıcı bilgileri (plan oluşturulurken)
  weight          Float
  height          Float
  gender          String
  goal            String
  
  // Öğünler (JSON olarak saklanır)
  breakfastItems  String   // JSON array
  breakfastCals   Int
  lunchItems      String   // JSON array
  lunchCals       Int
  snackItems      String   // JSON array
  snackCals       Int
  dinnerItems     String   // JSON array
  dinnerCals      Int
  
  totalCalories   Int
  advice          String?
  
  isActive        Boolean  @default(true)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  // Öğün tamamlama kayıtları
  completions     DietMealCompletion[]
}

// Öğün tamamlama takibi
model DietMealCompletion {
  id          Int      @id @default(autoincrement())
  dietPlanId  Int
  dietPlan    DietPlan @relation(fields: [dietPlanId], references: [id])
  
  mealType    String   // "breakfast", "lunch", "snack", "dinner"
  completed   Boolean  @default(true)
  date        DateTime @default(now())
  
  @@unique([dietPlanId, mealType, date])
}

// Şifre sıfırlama tokenları
model PasswordResetToken {
  id        Int      @id @default(autoincrement())
  userId    Int
  user      User     @relation(fields: [userId], references: [id])
  token     String   @unique
  expiresAt DateTime
  used      Boolean  @default(false)
  createdAt DateTime @default(now())
}